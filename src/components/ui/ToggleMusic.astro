---
import { Volume2, VolumeX } from "@lucide/astro/icons";
---

<button
  id="musicToggle"
  aria-label="Play music"
  class="fixed bottom-6 right-6 z-50 bg-bg-burgundy/40 backdrop-blur-md p-3 rounded-full hover:bg-bg-burgundy/60 transition"
>
  <div id="iconPlay">
    <Volume2 size={24} class="text-white" />
  </div>
  <div id="iconPause" class="hidden">
    <VolumeX size={24} class="text-white" />
  </div>
</button>

<audio id="bgMusic" loop preload="auto">
  <source src="https://res.cloudinary.com/dhcvj3jms/video/upload/v1769186880/The-Police-Every-Breath-You-Take-instrumentalfx_fnaeef.mp3" type="audio/mpeg" />
</audio>

<script>
  const audio = document.getElementById("bgMusic") as HTMLAudioElement | null;
  const btn = document.getElementById("musicToggle") as HTMLButtonElement | null;
  const iconPlay = document.getElementById("iconPlay");
  const iconPause = document.getElementById("iconPause");

  if (audio && btn && iconPlay && iconPause) {
    let isPlaying = false;

    btn.addEventListener("click", () => {
      if (!isPlaying) {
        audio.volume = 0.15;
        audio.play().then(() => {
          isPlaying = true;
          iconPlay.classList.add("hidden");
          iconPause.classList.remove("hidden");
          btn.setAttribute("aria-label", "Pause music");
        }).catch(err => console.error("Playback blocked:", err));
      } else {
        audio.pause();
        isPlaying = false;
        iconPlay.classList.remove("hidden");
        iconPause.classList.add("hidden");
        btn.setAttribute("aria-label", "Play music");
      }
    });
  }
</script>